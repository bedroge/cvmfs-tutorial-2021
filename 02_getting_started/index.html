
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>Getting started - CernVM-FS tutorial</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#getting-started" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="CernVM-FS tutorial" class="md-header-nav__button md-logo" aria-label="CernVM-FS tutorial">
      
  <img src="../img/cvmfs_logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            CernVM-FS tutorial
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Getting started
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/cvmfs-contrib/cvmfs-tutorial-2021/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CernVM-FS tutorial
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CernVM-FS tutorial" class="md-nav__button md-logo" aria-label="CernVM-FS tutorial">
      
  <img src="../img/cvmfs_logo.png" alt="logo">

    </a>
    CernVM-FS tutorial
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cvmfs-contrib/cvmfs-tutorial-2021/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    CernVM-FS tutorial
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../00_practical_info/" class="md-nav__link">
      Practical information
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../01_introduction/" class="md-nav__link">
      Introduction to CernVM-FS
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Getting started
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Getting started
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#set-up-the-stratum-0" class="md-nav__link">
    Set up the Stratum 0
  </a>
  
    <nav class="md-nav" aria-label="Set up the Stratum 0">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-apache" class="md-nav__link">
    Start Apache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-repository" class="md-nav__link">
    Create a repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository-keys" class="md-nav__link">
    Repository keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-some-files-to-the-repository" class="md-nav__link">
    Add some files to the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjob-for-resigning-the-whitelist" class="md-nav__link">
    Cronjob for resigning the whitelist
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-a-repository" class="md-nav__link">
    Remove a repository
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-a-client" class="md-nav__link">
    Set up a client
  </a>
  
    <nav class="md-nav" aria-label="Set up a client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation_1" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etccvmfskeysorganizationtldrepoorganizationtldpub" class="md-nav__link">
    /etc/cvmfs/keys/organization.tld/repo.organization.tld.pub
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etccvmfsconfigdrepoorganizationtldconf" class="md-nav__link">
    /etc/cvmfs/config.d/repo.organization.tld.conf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etccvmfsdefaultlocal" class="md-nav__link">
    /etc/cvmfs/default.local
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mount-the-repositories" class="md-nav__link">
    Mount the repositories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#browse-the-repository" class="md-nav__link">
    Browse the repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../03_stratum1_proxies/" class="md-nav__link">
      Stratum-1 + proxies
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../04_publishing/" class="md-nav__link">
      Publishing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../05_advanced/" class="md-nav__link">
      Advanced topics
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#set-up-the-stratum-0" class="md-nav__link">
    Set up the Stratum 0
  </a>
  
    <nav class="md-nav" aria-label="Set up the Stratum 0">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#start-apache" class="md-nav__link">
    Start Apache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-repository" class="md-nav__link">
    Create a repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#repository-keys" class="md-nav__link">
    Repository keys
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#add-some-files-to-the-repository" class="md-nav__link">
    Add some files to the repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cronjob-for-resigning-the-whitelist" class="md-nav__link">
    Cronjob for resigning the whitelist
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#remove-a-repository" class="md-nav__link">
    Remove a repository
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-a-client" class="md-nav__link">
    Set up a client
  </a>
  
    <nav class="md-nav" aria-label="Set up a client">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#installation_1" class="md-nav__link">
    Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav" aria-label="Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etccvmfskeysorganizationtldrepoorganizationtldpub" class="md-nav__link">
    /etc/cvmfs/keys/organization.tld/repo.organization.tld.pub
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etccvmfsconfigdrepoorganizationtldconf" class="md-nav__link">
    /etc/cvmfs/config.d/repo.organization.tld.conf
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etccvmfsdefaultlocal" class="md-nav__link">
    /etc/cvmfs/default.local
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mount-the-repositories" class="md-nav__link">
    Mount the repositories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#browse-the-repository" class="md-nav__link">
    Browse the repository
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exercise" class="md-nav__link">
    Exercise
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cvmfs-contrib/cvmfs-tutorial-2021/edit/master/docs/02_getting_started.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="getting-started">Getting started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h1>
<p>In order to get started with CernVM-FS, the first thing you need is a Stratum 0 server. This is the central server that hosts your repositories and makes it available to other machines. There can be only one Stratum 0 server for each repository, and from a security perspective it is usually recommended to restrict the access to this machine. We will look more into that later; for now, we are going to set up a Stratum 0, make a repository, and connect from a client machine directly to the Stratum 0.</p>
<h2 id="set-up-the-stratum-0">Set up the Stratum 0<a class="headerlink" href="#set-up-the-stratum-0" title="Permanent link">&para;</a></h2>
<h3 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h3>
<p>Due to the scalable design of CernVM-FS, the host of your Stratum 0 server does not need a lot of resources in terms of CPU cores and memory; just a few cores and a few gigabytes of memory should suffice. Besides this, you need plenty of space to store the contents of your repository. By default, CernVM-FS uses <code>/var/spool</code> as scratch space while adding new files to the repository, and <code>/srv/cvmfs</code> as central repository storage location, but these locations can be modified in the CernVM-FS server settings later on.</p>
<p>Furthermore, several (popular) Linux distributions are supported, see <a href="https://github.com/cvmfs-contrib/cvmfs-tutorial-2021/wiki/Notes#stratum-1--proxies">these requirements</a> for a full list. We will only focus on CentOS in this tutorial.</p>
<p>CernVM-FS also offers support for hosting the repository contents in S3 compatible storage, but for this tutorial we will focus on storing the files locally. For this we need an Apache server on the host, and port 80 should be open.</p>
<h3 id="installation">Installation<a class="headerlink" href="#installation" title="Permanent link">&para;</a></h3>
<p>The installation of CernVM-FS is simple and only requires some packages to be installed. You can easily do this by adding the CernVM-FS repository and install the packages through your package manager:</p>
<div class="highlight"><pre><span></span><code>sudo yum install -y https://ecsft.cern.ch/dist/cvmfs/cvmfs-release/cvmfs-release-latest.noarch.rpm
sudo yum install -y epel-release
sudo yum install -y cvmfs cvmfs-server
</code></pre></div>
<p>Alternatively, you can download the packages from the <a href="https://cernvm.cern.ch/fs/">CernVM-FS downloads page</a> and install them package manually; note that you need both the client and server package on your Stratum 0.</p>
<h3 id="start-apache">Start Apache<a class="headerlink" href="#start-apache" title="Permanent link">&para;</a></h3>
<p>Since the Stratum 0 is serving contents via HTTP, Apache needs to be running before we can make a repository. The Apache (<code>httpd</code>) package should have been installed already, as it is a dependency of the <code>cvmfs-server</code> package, so it can now be enabled (so that it always starts after a reboot) and started using:
<div class="highlight"><pre><span></span><code>sudo systemctl enable httpd
sudo systemctl start httpd
</code></pre></div></p>
<h3 id="create-a-repository">Create a repository<a class="headerlink" href="#create-a-repository" title="Permanent link">&para;</a></h3>
<p>Now that all required packages have been installed, it is time to create a repository. In the simplest way, this can be done by running the following command, which will make <code>$USER</code> the owner of the repository:
<div class="highlight"><pre><span></span><code>sudo cvmfs_server mkfs -o <span class="nv">$USER</span> repo.organization.tld
</code></pre></div></p>
<p>The full repository name, here <code>repo.organization.tld</code>, resembles a DNS name, but the <code>organization.tld</code> domain does not necessarily have to exist. It is recommended to give all the repositories belonging to the same project or organization the same <code>.organization.tld</code> domain here. This makes the client configuration much easier, also in case new repositories will be added later on.</p>
<h3 id="repository-keys">Repository keys<a class="headerlink" href="#repository-keys" title="Permanent link">&para;</a></h3>
<p>For each repository that you create, a set of keys will be generated in <code>/etc/cvmfs/keys</code>:
 - <code>repo.organization.tld.crt</code> -  the repository’s public key (encoded as X509 certificate);
 - <code>repo.organization.tld.key</code> - the repository's private key;
 - <code>repo.organization.tld.masterkey</code> - the repository's private master key;
 - <code>repo.organization.tld.pub</code> -  repository’s public key (RSA).</p>
<p>The public key is the one that is needed by clients in order to access the repository; we will need this later on. The master key is used to sign a whitelist of known publisher certificates; this whitelist is, by default, valid for 30 days, so the signing has to be done regularly.</p>
<p>For now we are going to use one master key per repository, but in practice it is recommended to use the same master key for all repositories under a single domain, so that clients only need a single public key to access all repositories under this domain. We will explain this in more detail in the advanced section.
TODO: DO WE WANT TO EXPLAIN THIS?</p>
<h3 id="add-some-files-to-the-repository">Add some files to the repository<a class="headerlink" href="#add-some-files-to-the-repository" title="Permanent link">&para;</a></h3>
<p>A new repository automatically gets a file <code>new_repository</code> in its root (<code>/cvmfs/repo.organization.tld</code>). You can add more files by starting and publishing a transaction, which will be explained in more detail in a later section. For now it is enough to just run the following commands as root:</p>
<div class="highlight"><pre><span></span><code><span class="nv">MY_REPO_NAME</span><span class="o">=</span>repo.organization.tld

sudo cvmfs_server transaction <span class="si">${</span><span class="nv">MY_REPO_NAME</span><span class="si">}</span>

<span class="c1"># Now make some changes in /cvmfs/${MY_REPO_NAME},</span>
<span class="c1"># e.g. by adding files or directories.</span>
<span class="c1"># If you made $USER the owner of the repository, you can do this without sudo.</span>

sudo cvmfs_server publish <span class="si">${</span><span class="nv">MY_REPO_NAME</span><span class="si">}</span>
</code></pre></div>
<h3 id="cronjob-for-resigning-the-whitelist">Cronjob for resigning the whitelist<a class="headerlink" href="#cronjob-for-resigning-the-whitelist" title="Permanent link">&para;</a></h3>
<p>Each CernVM-FS repository has a whitelist containing fingerprints of certificates that are allowed to sign the repository. This whitelist has an expiration time of, by default, 30 days. This means that you regularly have to resign the whitelist. There are several ways to do this, see for instance <a href="https://cvmfs.readthedocs.io/en/stable/cpt-repo.html#sct-master-keys">the page about master keys</a> in the documentation.</p>
<p>If you just keep the master key on our Stratum 0 sever, you can set up a simple cronjob for resigning the whitelist. For instance, make a file <code>/etc/cron.d/cvmfs_resign</code> with the following content to do this every Monday at 11:00:
<div class="highlight"><pre><span></span><code>0 11 * * 1 root /usr/bin/cvmfs_server resign repo.organization.tld
</code></pre></div></p>
<h3 id="remove-a-repository">Remove a repository<a class="headerlink" href="#remove-a-repository" title="Permanent link">&para;</a></h3>
<p>An existing repository can be removed by running:
<div class="highlight"><pre><span></span><code>sudo cvmfs_server rmfs repo.organization.tld
</code></pre></div></p>
<h2 id="set-up-a-client">Set up a client<a class="headerlink" href="#set-up-a-client" title="Permanent link">&para;</a></h2>
<p>Accessing CernVM-FS repositories on a client machine involves three steps: installing the CernVM-FS client package, adding some configuration files for the repository you want to connect to, and finally run a CernVM-FS setup procedure that will mount the repository.</p>
<p>Since the client is going to pull in files over an HTTP connection, you need sufficient space for storing a local cache on the client machine. You can define the maximum size of your cache in the settings; the larger your cache is, the less often you have to pull in files again, and the faster your applications will start. Note that you can add more cache layers by adding a proxy nearby your client; this will be covered in a later section.</p>
<h3 id="installation_1">Installation<a class="headerlink" href="#installation_1" title="Permanent link">&para;</a></h3>
<p>The installation is the same as for the Stratum 0, except that you only need the <code>cvmfs</code> package:</p>
<div class="highlight"><pre><span></span><code>sudo yum install https://ecsft.cern.ch/dist/cvmfs/cvmfs-release/cvmfs-release-latest.noarch.rpm
sudo yum install -y cvmfs
</code></pre></div>
<h3 id="configuration">Configuration<a class="headerlink" href="#configuration" title="Permanent link">&para;</a></h3>
<p>Many popular/large organizations hosting CernVM-FS repositories offer a client package that you can install to do most of the configuration. For our repository, we are going to do this manually. All required configuration files will have to be stored somewhere under <code>/etc/cvmfs</code>. We will discuss them one by one, where we use <code>repo.organization.tld</code> as repository name, and hence <code>organization.tld</code> as domain.</p>
<h4 id="etccvmfskeysorganizationtldrepoorganizationtldpub">/etc/cvmfs/keys/organization.tld/repo.organization.tld.pub<a class="headerlink" href="#etccvmfskeysorganizationtldrepoorganizationtldpub" title="Permanent link">&para;</a></h4>
<p>This file contains the public key of the repository you want to access. You can copy this file from your Stratum 0 server, where it should be stored at the same location.</p>
<h4 id="etccvmfsconfigdrepoorganizationtldconf">/etc/cvmfs/config.d/repo.organization.tld.conf<a class="headerlink" href="#etccvmfsconfigdrepoorganizationtldconf" title="Permanent link">&para;</a></h4>
<p>This file contains the main configuration for the repository you want to access, which should minimally contain the URL(s) of the Stratum 1 servers and the location of the public key. Because we do not have a Stratum 1 server yet, we are going to (mis)use our Stratum 0 as a Stratum 1. You should not do this in production!</p>
<p>A typical, minimal configuration should look as follows:<br />
<div class="highlight"><pre><span></span><code>CVMFS_SERVER_URL=&quot;http://your-stratum0/cvmfs/@fqrn@&quot;
CVMFS_PUBLIC_KEY=&quot;/etc/cvmfs/keys/organization.tld/repo.organization.tld.pub&quot;
</code></pre></div>
Note that the <code>CVMFS_SERVER_URL</code> should have the <code>/cvmfs/@fqrn</code>; the last part will automatically be replaced by the full name of your repository.</p>
<h4 id="etccvmfsdefaultlocal">/etc/cvmfs/default.local<a class="headerlink" href="#etccvmfsdefaultlocal" title="Permanent link">&para;</a></h4>
<p>This file can be used for setting or overriding settings that are specific to your client machine. One required parameter is <code>CVMFS_HTTP_PROXY</code>, which should point to your local proxy that serves as a cache between your client(s) and the Stratum 1 server(s). Since we do not have a proxy yet, we are setting this to <code>DIRECT</code>, meaning that we connect directly to the Stratum 1:
<div class="highlight"><pre><span></span><code>CVMFS_HTTP_PROXY=DIRECT
</code></pre></div></p>
<p>You can also use this file to set a maximum size (in megabytes) for the cache, for instance:
<div class="highlight"><pre><span></span><code>CVMFS_QUOTA_LIMIT=50000
</code></pre></div></p>
<h3 id="mount-the-repositories">Mount the repositories<a class="headerlink" href="#mount-the-repositories" title="Permanent link">&para;</a></h3>
<p>When your configuration is complete, you can run the following command as root to mount the repository:
<div class="highlight"><pre><span></span><code>sudo cvmfs_config setup
</code></pre></div>
This should not return any error message.</p>
<h2 id="browse-the-repository">Browse the repository<a class="headerlink" href="#browse-the-repository" title="Permanent link">&para;</a></h2>
<p>Finally, we can try to access our repository on the client machine. Note that CernVM-FS uses <code>autofs</code>, which means that you may not see the repository when you do <code>ls /cvmfs</code>. Your repository will only be actually mounted when you access it, and may be unmounted after not using it for a while. So, the following should work and show the contents of your repository:
<div class="highlight"><pre><span></span><code>ls /cvmfs/repo.organization.tld
</code></pre></div></p>
<h2 id="exercise">Exercise<a class="headerlink" href="#exercise" title="Permanent link">&para;</a></h2>
<ul>
<li>Set up your own Stratum 0 on a virtual machine.</li>
<li>Create a repository with a suitable name (<code>name.domain.tld</code>).</li>
<li>Add a simple bash script to the repository, which, for instance, prints <code>Hello world!</code>.</li>
<li>Install and configure the CernVM-FS client on another virtual machine, using the Stratum 0 as your Stratum 1 for now.</li>
<li>Try to access your repository and run your bash script on the client.</li>
</ul>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">December 18, 2020</span>
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../01_introduction/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction to CernVM-FS
              </div>
            </div>
          </a>
        
        
          <a href="../03_stratum1_proxies/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Stratum-1 + proxies
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>